{% extends "base.html" %}
{% block content %}

<h2 class="text-center fw-bold mb-4 text-primary">Face Detection â€“ Recognition</h2>

<div class="row">
    <!-- Live Camera Section -->
    <div class="col-md-6 mb-4">
        <div class="card shadow">
            <div class="card-header text-white" style="background: linear-gradient(to right, #4facfe, #00f2fe);">
                <h5 class="mb-0"> Live Camera</h5>
            </div>
            <div class="card-body text-center">
                <video id="camera" width="100%" height="280" autoplay></video>
                <canvas id="snapshot" style="display:none;"></canvas>
                <form id="liveForm" method="POST">
                    <input type="hidden" name="captured_image" id="captured_image_data">
                    <button type="button" class="btn btn-outline-primary mt-3" onclick="captureImage()">ðŸ“¸ Capture & Match</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Upload & Preview Section -->
    <div class="col-md-6 mb-4">
        <div class="card shadow">
            <div class="card-header text-white" style="background: linear-gradient(to right, #4facfe, #00f2fe);">
                <h5 class="mb-0"> Upload Image</h5>
            </div>
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    <div class="mb-3">
                        <input type="file" class="form-control" name="upload_image" id="upload_image" accept="image/*" onchange="previewImage(event)" required>
                    </div>
                    <div class="text-center mb-3">
                        <img id="image_preview" src="#" alt="Preview" style="max-height: 250px; display: none; border-radius: 10px;">
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-success">Submit for Detection</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    const video = document.getElementById('camera');
    const canvas = document.getElementById('snapshot');
    const hiddenInput = document.getElementById('captured_image_data');

    navigator.mediaDevices.getUserMedia({ video: true }).then((stream) => {
        video.srcObject = stream;
    });

    function captureImage() {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        const imageData = canvas.toDataURL("image/jpeg");
        hiddenInput.value = imageData;
        document.getElementById('liveForm').submit();
    }

    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function(){
            const preview = document.getElementById('image_preview');
            preview.src = reader.result;
            preview.style.display = 'block';
        };
        reader.readAsDataURL(event.target.files[0]);
    }
</script>

{% endblock %}
